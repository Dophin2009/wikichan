!function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(1);window.addEventListener("mousedown",function(t){var e=document.caretPositionFromPoint(t.clientX,t.clientY),o=e.offsetNode,r=e.offset,i=new n.TextSource(o,r);console.log(i.phrase(2,2))})},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this._leftNode=t,this._rightNode=t,this._text=t.textContent,this._offset=e}return t.prototype.phrase=function(t,e){for(var o,n,r=this.offset,i=0;i<t+1;i++){for(;r>0&&(r--," "!==this.text[r]););0===r&&this.joinBefore()}o=r,r=this.offset;for(i=0;i<e+1;i++){for(;r<this.text.length&&(r++," "!==this.text[r]););r===this.text.length&&this.joinAfter()}return n=r,this.text.substring(o,n).trim()},t.prototype.joinAfter=function(){var t;this.rightNode=null===(t=this.rightNode).nextSibling?t.parentNode.nextSibling:t.nextSibling,this.addAfter(this.rightNode.textContent)},t.prototype.joinBefore=function(){var t;this.leftNode=null===(t=this.leftNode).previousSibling?t.parentNode.previousSibling:t.previousSibling,this.addBefore(this.leftNode.textContent)},t.prototype.addAfter=function(t){this.text+=t},t.prototype.addBefore=function(t){this.text=t+this.text,this.offset+=t.length},Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this._offset},set:function(t){this._offset=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftNode",{get:function(){return this._leftNode},set:function(t){this._leftNode=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightNode",{get:function(){return this._rightNode},set:function(t){this._rightNode=t},enumerable:!0,configurable:!0}),t}();e.TextSource=n}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3dpa2ljaGFuLnRzIiwid2VicGFjazovLy8uL3NyYy90ZXh0LXNvdXJjZS50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsInRleHRfc291cmNlXzEiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJyYW5nZSIsImRvY3VtZW50IiwiY2FyZXRQb3NpdGlvbkZyb21Qb2ludCIsImNsaWVudFgiLCJjbGllbnRZIiwidGV4dE5vZGUiLCJvZmZzZXROb2RlIiwib2Zmc2V0Iiwic291cmNlIiwiVGV4dFNvdXJjZSIsImNvbnNvbGUiLCJsb2ciLCJwaHJhc2UiLCJub2RlIiwidGhpcyIsIl9sZWZ0Tm9kZSIsIl9yaWdodE5vZGUiLCJfdGV4dCIsInRleHRDb250ZW50IiwiX29mZnNldCIsImJlZm9yZSIsImFmdGVyIiwiYmVnaW4iLCJlbmQiLCJrIiwidGV4dCIsImpvaW5CZWZvcmUiLCJsZW5ndGgiLCJqb2luQWZ0ZXIiLCJzdWJzdHJpbmciLCJ0cmltIiwicmlnaHROb2RlIiwibmV4dFNpYmxpbmciLCJwYXJlbnROb2RlIiwiYWRkQWZ0ZXIiLCJsZWZ0Tm9kZSIsInByZXZpb3VzU2libGluZyIsImFkZEJlZm9yZSIsInNldCIsImNvbmZpZ3VyYWJsZSJdLCJtYXBwaW5ncyI6ImFBQ0EsSUFBQUEsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLEdBQUEsQ0FDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxRQUFBLElBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQUtBRixFQUFBUSxFQUFBRixFQUdBTixFQUFBUyxFQUFBVixFQUdBQyxFQUFBVSxFQUFBLFNBQUFSLEVBQUFTLEVBQUFDLEdBQ0FaLEVBQUFhLEVBQUFYLEVBQUFTLElBQ0FHLE9BQUFDLGVBQUFiLEVBQUFTLEVBQUEsQ0FBMENLLFlBQUEsRUFBQUMsSUFBQUwsS0FLMUNaLEVBQUFrQixFQUFBLFNBQUFoQixHQUNBLG9CQUFBaUIsZUFBQUMsYUFDQU4sT0FBQUMsZUFBQWIsRUFBQWlCLE9BQUFDLFlBQUEsQ0FBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURtQixPQUFBLEtBUWpEckIsRUFBQXNCLEVBQUEsU0FBQUQsRUFBQUUsR0FFQSxHQURBLEVBQUFBLElBQUFGLEVBQUFyQixFQUFBcUIsSUFDQSxFQUFBRSxFQUFBLE9BQUFGLEVBQ0EsS0FBQUUsR0FBQSxpQkFBQUYsUUFBQUcsV0FBQSxPQUFBSCxFQUNBLElBQUFJLEVBQUFYLE9BQUFZLE9BQUEsTUFHQSxHQUZBMUIsRUFBQWtCLEVBQUFPLEdBQ0FYLE9BQUFDLGVBQUFVLEVBQUEsV0FBeUNULFlBQUEsRUFBQUssVUFDekMsRUFBQUUsR0FBQSxpQkFBQUYsRUFBQSxRQUFBTSxLQUFBTixFQUFBckIsRUFBQVUsRUFBQWUsRUFBQUUsRUFBQSxTQUFBQSxHQUFnSCxPQUFBTixFQUFBTSxJQUFxQkMsS0FBQSxLQUFBRCxJQUNySSxPQUFBRixHQUlBekIsRUFBQTZCLEVBQUEsU0FBQTFCLEdBQ0EsSUFBQVMsRUFBQVQsS0FBQXFCLFdBQ0EsV0FBMkIsT0FBQXJCLEVBQUEsU0FDM0IsV0FBaUMsT0FBQUEsR0FFakMsT0FEQUgsRUFBQVUsRUFBQUUsRUFBQSxJQUFBQSxHQUNBQSxHQUlBWixFQUFBYSxFQUFBLFNBQUFpQixFQUFBQyxHQUFzRCxPQUFBakIsT0FBQWtCLFVBQUFDLGVBQUExQixLQUFBdUIsRUFBQUMsSUFHdEQvQixFQUFBa0MsRUFBQSxHQUlBbEMsSUFBQW1DLEVBQUEsa0NDakZBckIsT0FBQUMsZUFBQWIsRUFBQSxjQUE4Q21CLE9BQUEsSUFDOUMsSUFBQWUsRUFBb0JwQyxFQUFRLEdBQzVCcUMsT0FBQUMsaUJBQUEsWUFDQSxTQUFBQyxHQUNBLElBQUFDLEVBQUFDLFNBQUFDLHVCQUFBSCxFQUFBSSxRQUFBSixFQUFBSyxTQUNBQyxFQUFBTCxFQUFBTSxXQUNBQyxFQUFBUCxFQUFBTyxPQUVBQyxFQUFBLElBQUFaLEVBQUFhLFdBQUFKLEVBQUFFLEdBQ0FHLFFBQUFDLElBQUFILEVBQUFJLE9BQUEsc0NDVEF0QyxPQUFBQyxlQUFBYixFQUFBLGNBQThDbUIsT0FBQSxJQUM5QyxJQUFBNEIsRUFBQSxXQUNBLFNBQUFBLEVBQUFJLEVBQUFOLEdBQ0FPLEtBQUFDLFVBQUFGLEVBQ0FDLEtBQUFFLFdBQUFILEVBQ0FDLEtBQUFHLE1BQUFKLEVBQUFLLFlBQ0FKLEtBQUFLLFFBQUFaLEVBc0ZBLE9BcEZBRSxFQUFBakIsVUFBQW9CLE9BQUEsU0FBQVEsRUFBQUMsR0FJQSxJQUhBLElBQ0FDLEVBQ0FDLEVBRkEzRCxFQUFBa0QsS0FBQVAsT0FHQWlCLEVBQUEsRUFBdUJBLEVBQUFKLEVBQUEsRUFBZ0JJLElBQUEsQ0FDdkMsS0FBQTVELEVBQUEsSUFDQUEsSUFDQSxNQUFBa0QsS0FBQVcsS0FBQTdELE1BR0EsSUFBQUEsR0FDQWtELEtBQUFZLGFBR0FKLEVBQUExRCxFQUNBQSxFQUFBa0QsS0FBQVAsT0FDQSxJQUFBaUIsRUFBQSxFQUF1QkEsRUFBQUgsRUFBQSxFQUFlRyxJQUFBLENBQ3RDLEtBQUE1RCxFQUFBa0QsS0FBQVcsS0FBQUUsU0FDQS9ELElBQ0EsTUFBQWtELEtBQUFXLEtBQUE3RCxNQUdBQSxJQUFBa0QsS0FBQVcsS0FBQUUsUUFDQWIsS0FBQWMsWUFJQSxPQURBTCxFQUFBM0QsRUFDQWtELEtBQUFXLEtBQUFJLFVBQUFQLEVBQUFDLEdBQUFPLFFBRUFyQixFQUFBakIsVUFBQW9DLFVBQUEsV0EwREEsSUFBQWYsRUF6REFDLEtBQUFpQixVQTBEQSxRQURBbEIsRUF6REFDLEtBQUFpQixXQTBEQUMsWUFBQW5CLEVBQUFvQixXQUFBRCxZQUFBbkIsRUFBQW1CLFlBekRBbEIsS0FBQW9CLFNBQUFwQixLQUFBaUIsVUFBQWIsY0FFQVQsRUFBQWpCLFVBQUFrQyxXQUFBLFdBeURBLElBQUFiLEVBeERBQyxLQUFBcUIsU0F5REEsUUFEQXRCLEVBeERBQyxLQUFBcUIsVUF5REFDLGdCQUFBdkIsRUFBQW9CLFdBQUFHLGdCQUFBdkIsRUFBQXVCLGdCQXhEQXRCLEtBQUF1QixVQUFBdkIsS0FBQXFCLFNBQUFqQixjQUVBVCxFQUFBakIsVUFBQTBDLFNBQUEsU0FBQVQsR0FDQVgsS0FBQVcsU0FFQWhCLEVBQUFqQixVQUFBNkMsVUFBQSxTQUFBWixHQUNBWCxLQUFBVyxPQUFBWCxLQUFBVyxLQUNBWCxLQUFBUCxRQUFBa0IsRUFBQUUsUUFFQXJELE9BQUFDLGVBQUFrQyxFQUFBakIsVUFBQSxRQUNBZixJQUFBLFdBQ0EsT0FBQXFDLEtBQUFHLE9BRUFxQixJQUFBLFNBQUF6RCxHQUNBaUMsS0FBQUcsTUFBQXBDLEdBRUFMLFlBQUEsRUFDQStELGNBQUEsSUFFQWpFLE9BQUFDLGVBQUFrQyxFQUFBakIsVUFBQSxVQUNBZixJQUFBLFdBQ0EsT0FBQXFDLEtBQUFLLFNBRUFtQixJQUFBLFNBQUF6RCxHQUNBaUMsS0FBQUssUUFBQXRDLEdBRUFMLFlBQUEsRUFDQStELGNBQUEsSUFFQWpFLE9BQUFDLGVBQUFrQyxFQUFBakIsVUFBQSxZQUNBZixJQUFBLFdBQ0EsT0FBQXFDLEtBQUFDLFdBRUF1QixJQUFBLFNBQUF6RCxHQUNBaUMsS0FBQUMsVUFBQWxDLEdBRUFMLFlBQUEsRUFDQStELGNBQUEsSUFFQWpFLE9BQUFDLGVBQUFrQyxFQUFBakIsVUFBQSxhQUNBZixJQUFBLFdBQ0EsT0FBQXFDLEtBQUFFLFlBRUFzQixJQUFBLFNBQUF6RCxHQUNBaUMsS0FBQUUsV0FBQW5DLEdBRUFMLFlBQUEsRUFDQStELGNBQUEsSUFFQTlCLEVBM0ZBLEdBNkZBL0MsRUFBQStDIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbnZhciB0ZXh0X3NvdXJjZV8xID0gcmVxdWlyZShcIi4vdGV4dC1zb3VyY2VcIik7XHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGdldFdvcmRVbmRlckN1cnNvcik7XHJcbmZ1bmN0aW9uIGdldFdvcmRVbmRlckN1cnNvcihldmVudCkge1xyXG4gICAgdmFyIHJhbmdlID0gZG9jdW1lbnQuY2FyZXRQb3NpdGlvbkZyb21Qb2ludChldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZKTtcclxuICAgIHZhciB0ZXh0Tm9kZSA9IHJhbmdlLm9mZnNldE5vZGU7XHJcbiAgICB2YXIgb2Zmc2V0ID0gcmFuZ2Uub2Zmc2V0O1xyXG4gICAgLy8gY29uc29sZS5sb2coZ2V0UHJldmlvdXNOb2RlKHRleHROb2RlKS50ZXh0Q29udGVudCArIGRhdGEgKyBnZXROZXh0Tm9kZSh0ZXh0Tm9kZSkudGV4dENvbnRlbnQpO1xyXG4gICAgdmFyIHNvdXJjZSA9IG5ldyB0ZXh0X3NvdXJjZV8xLlRleHRTb3VyY2UodGV4dE5vZGUsIG9mZnNldCk7XHJcbiAgICBjb25zb2xlLmxvZyhzb3VyY2UucGhyYXNlKDIsIDIpKTtcclxuICAgIC8vIGNvbnNvbGUubG9nKHNvdXJjZS50ZXh0KTtcclxuICAgIC8vIHNvdXJjZS5qb2luQWZ0ZXIoKTtcclxuICAgIC8vIHNvdXJjZS5qb2luQmVmb3JlKCk7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhzb3VyY2UudGV4dCk7XHJcbn1cclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIFRleHRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBUZXh0U291cmNlKG5vZGUsIG9mZnNldCkge1xyXG4gICAgICAgIHRoaXMuX2xlZnROb2RlID0gbm9kZTtcclxuICAgICAgICB0aGlzLl9yaWdodE5vZGUgPSBub2RlO1xyXG4gICAgICAgIHRoaXMuX3RleHQgPSBub2RlLnRleHRDb250ZW50O1xyXG4gICAgICAgIHRoaXMuX29mZnNldCA9IG9mZnNldDtcclxuICAgIH1cclxuICAgIFRleHRTb3VyY2UucHJvdG90eXBlLnBocmFzZSA9IGZ1bmN0aW9uIChiZWZvcmUsIGFmdGVyKSB7XHJcbiAgICAgICAgdmFyIGkgPSB0aGlzLm9mZnNldDtcclxuICAgICAgICB2YXIgYmVnaW47XHJcbiAgICAgICAgdmFyIGVuZDtcclxuICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGJlZm9yZSArIDE7IGsrKykge1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA+IDApIHtcclxuICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRleHRbaV0gPT09IFwiIFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmpvaW5CZWZvcmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBiZWdpbiA9IGk7XHJcbiAgICAgICAgaSA9IHRoaXMub2Zmc2V0O1xyXG4gICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgYWZ0ZXIgKyAxOyBrKyspIHtcclxuICAgICAgICAgICAgd2hpbGUgKGkgPCB0aGlzLnRleHQubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50ZXh0W2ldID09PSBcIiBcIilcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaSA9PT0gdGhpcy50ZXh0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5qb2luQWZ0ZXIoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbmQgPSBpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRleHQuc3Vic3RyaW5nKGJlZ2luLCBlbmQpLnRyaW0oKTtcclxuICAgIH07XHJcbiAgICBUZXh0U291cmNlLnByb3RvdHlwZS5qb2luQWZ0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5yaWdodE5vZGUgPSBnZXROZXh0Tm9kZSh0aGlzLnJpZ2h0Tm9kZSk7XHJcbiAgICAgICAgdGhpcy5hZGRBZnRlcih0aGlzLnJpZ2h0Tm9kZS50ZXh0Q29udGVudCk7XHJcbiAgICB9O1xyXG4gICAgVGV4dFNvdXJjZS5wcm90b3R5cGUuam9pbkJlZm9yZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmxlZnROb2RlID0gZ2V0UHJldmlvdXNOb2RlKHRoaXMubGVmdE5vZGUpO1xyXG4gICAgICAgIHRoaXMuYWRkQmVmb3JlKHRoaXMubGVmdE5vZGUudGV4dENvbnRlbnQpO1xyXG4gICAgfTtcclxuICAgIFRleHRTb3VyY2UucHJvdG90eXBlLmFkZEFmdGVyID0gZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICB0aGlzLnRleHQgKz0gdGV4dDtcclxuICAgIH07XHJcbiAgICBUZXh0U291cmNlLnByb3RvdHlwZS5hZGRCZWZvcmUgPSBmdW5jdGlvbiAodGV4dCkge1xyXG4gICAgICAgIHRoaXMudGV4dCA9IHRleHQgKyB0aGlzLnRleHQ7XHJcbiAgICAgICAgdGhpcy5vZmZzZXQgKz0gdGV4dC5sZW5ndGg7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRleHRTb3VyY2UucHJvdG90eXBlLCBcInRleHRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGV4dDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3RleHQgPSB2YWx1ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXh0U291cmNlLnByb3RvdHlwZSwgXCJvZmZzZXRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fb2Zmc2V0O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5fb2Zmc2V0ID0gdmFsdWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGV4dFNvdXJjZS5wcm90b3R5cGUsIFwibGVmdE5vZGVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbGVmdE5vZGU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9sZWZ0Tm9kZSA9IHZhbHVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRleHRTb3VyY2UucHJvdG90eXBlLCBcInJpZ2h0Tm9kZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yaWdodE5vZGU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9yaWdodE5vZGUgPSB2YWx1ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBUZXh0U291cmNlO1xyXG59KCkpO1xyXG5leHBvcnRzLlRleHRTb3VyY2UgPSBUZXh0U291cmNlO1xyXG5mdW5jdGlvbiBnZXROZXh0Tm9kZShub2RlKSB7XHJcbiAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZyA9PT0gbnVsbCA/IG5vZGUucGFyZW50Tm9kZS5uZXh0U2libGluZyA6IG5vZGUubmV4dFNpYmxpbmc7XHJcbn1cclxuZnVuY3Rpb24gZ2V0UHJldmlvdXNOb2RlKG5vZGUpIHtcclxuICAgIHJldHVybiBub2RlLnByZXZpb3VzU2libGluZyA9PT0gbnVsbCA/IG5vZGUucGFyZW50Tm9kZS5wcmV2aW91c1NpYmxpbmcgOiBub2RlLnByZXZpb3VzU2libGluZztcclxufVxyXG4iXSwic291cmNlUm9vdCI6IiJ9